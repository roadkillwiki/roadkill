{"ts":1354887849635,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"﻿using System;\r\nusing System.Text;\r\nusing System.Collections.Generic;\r\nusing System.Linq;\r\nusing Roadkill.Core;\r\nusing Roadkill.Tests.Core;\r\nusing NUnit.Framework;\r\nusing System.IO;\r\n\r\nusing Plasma.Core;\r\nusing Plasma.WebDriver;\r\nusing OpenQA.Selenium;\r\nusing System.Diagnostics;\r\nusing HtmlAgilityPack;\r\nusing Fizzler.Systems.HtmlAgilityPack;\r\nusing SimpleBrowser.WebDriver;\r\nusing System.Threading;\r\nusing OpenQA.Selenium.Firefox;\r\n\r\nnamespace Roadkill.Tests.Acceptance\r\n{\r\n\t/// <summary>\r\n\t/// Web tests using a headless browser (non-javascript interaction)\r\n\t/// </summary>\r\n\t[TestFixture]\r\n\t[Category(\"Acceptance\")]\r\n\t[Explicit]\r\n\tpublic class PageTests : AcceptanceTestBase\r\n\t{\r\n\t\t[Test]\r\n\t\tpublic void No_MainPage_Set()\r\n\t\t{\r\n\t\t\t// Arrange + Act\r\n\t\t\tDriver.Navigate().GoToUrl(BaseUrl);\r\n\t\t\t\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\".pagetitle\")).Text, Is.EqualTo(\"You have no mainpage set\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#pagecontent p\")).Text, Is.EqualTo(\"To set a main page, create a page and assign the tag 'homepage' to it.\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void No_Extra_Menu_Options_For_Anonymous_Users()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLogout();\r\n\r\n\t\t\t// Act\r\n\t\t\tIEnumerable<IWebElement> leftmenuItems = Driver.FindElements(By.CssSelector(\"div#leftmenu li\"));\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(leftmenuItems.Count(), Is.EqualTo(3));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void Login_As_Admin_Shows_All_Left_Menu_Options()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\r\n\t\t\t// Act\r\n\t\t\tIEnumerable<IWebElement> leftmenuItems = Driver.FindElements(By.CssSelector(\"div#leftmenu li\"));\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(leftmenuItems.Count(), Is.EqualTo(5));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void Login_As_Editor_Shows_Extra_Menu_Option()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\r\n\t\t\t// Act\r\n\t\t\tIEnumerable<IWebElement> leftmenuItems = Driver.FindElements(By.CssSelector(\"div#leftmenu li\"));\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(leftmenuItems.Count(), Is.EqualTo(4));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void NewPage_With_Homepage_Tag_Shows_As_Homepage()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\r\n\t\t\t// Act\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Assert\r\n\t\t\tDriver.Navigate().GoToUrl(BaseUrl);\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\".pagetitle\")).Text, Contains.Substring(\"My title\"));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#pagecontent p\")).Text, Contains.Substring(\"Some content goes here\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void AllTagsPage_Displays_Correct_Tags_For_All_Users()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\t\t\tCreatePageWithTags(\"Tag1\", \"Tag2\");\r\n\r\n\t\t\t// Act\t\r\n\t\t\tDriver.Navigate().GoToUrl(LogoutUrl);\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/alltags']\")).Click();\r\n\t\t\t\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#tagcloud a\")).Count, Is.EqualTo(2));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#tagcloud a\"))[0].Text, Is.EqualTo(\"Tag1\"));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#tagcloud a\"))[1].Text, Is.EqualTo(\"Tag2\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\t[RequiresBrowserWithJavascript]\r\n\t\tpublic void EditIcon_Exists_For_Editors()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#toolbar i.icon-pencil\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#pageedit-button\")).Count, Is.EqualTo(1));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\t[RequiresBrowserWithJavascript]\r\n\t\tpublic void EditIcon_Exists_For_Admins()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#toolbar i.icon-pencil\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#pageedit-button\")).Count, Is.EqualTo(1));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\t[RequiresBrowserWithJavascript]\r\n\t\tpublic void Properties_Icon_Exists_For_Editors()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#toolbar i.icon-book\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#pageinfo-button\")).Count, Is.EqualTo(1));\r\n\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#pageinfo-button\")).Click();\r\n\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#pageinformation\")).GetCssValue(\"display\"), Is.EqualTo(\"block\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\t[RequiresBrowserWithJavascript]\r\n\t\tpublic void Properties_Icon_Exists_For_Admin()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#toolbar i.icon-book\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#pageinfo-button\")).Count, Is.EqualTo(1));\r\n\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#pageinfo-button\")).Click();\r\n\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#pageinformation\")).GetCssValue(\"display\"), Is.EqualTo(\"block\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void View_History_Link_Exists_For_All_Users()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\"#viewhistory\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElement(By.CssSelector(\"#viewhistory a\")).Text, Is.EqualTo(\"View History\"));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void All_Pages_Has_Edit_But_No_Delete_Button_For_Editor()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(0));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void All_Pages_Has_Edit_And_Delete_Button_For_Admin()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(1));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void All_Pages_Has_No_Buttons_For_Anonymous()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\t\t\tLogout();\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/alltags']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#tagcloud a\")).Click();\t\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(0));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(0));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void TagPage_Has_Edit_And_Delete_Button_For_Admin()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/alltags']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#tagcloud a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(0));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void TagPage_Has_Edit_But_No_Delete_Button_For_Editor()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/alltags']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#tagcloud a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(0));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void TagPage_Has_No_Buttons_For_Anonymous()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\t\t\tLogout();\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/alltags']\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(0));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(0));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void ByUserPage_Has_Edit_And_Delete_Button_For_Admin()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#viewhistory a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#historytable .editedby a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(1));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void ByUserPage_Has_Edit_But_No_Delete_Button_For_Editor()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#viewhistory a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#historytable .editedby a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(1));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(0));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void ByUserPage_Has_No_Buttons_For_Anonymous()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\t\t\tLogout();\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#viewhistory a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#historytable .editedby a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .edit a\")).Count, Is.EqualTo(0));\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .delete a\")).Count, Is.EqualTo(0));\r\n\t\t}\r\n\r\n\t\t///\r\n\r\n\t\t[Test]\r\n\t\tpublic void HistoryPage_Has_Revert_For_Admin()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsAdmin();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#pageedit-button\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Save]\")).Click();\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#viewhistory a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .revert a\")).Count, Is.EqualTo(1));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void HistoryPage_Has_Revert_For_Editor()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#pageedit-button\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Save]\")).Click();\r\n\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#viewhistory a\")).Click();\r\n\t\t\t\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .revert a\")).Count, Is.EqualTo(1));\r\n\t\t}\r\n\r\n\t\t[Test]\r\n\t\tpublic void HistoryPage_Has_No_Revert_For_Anonymous()\r\n\t\t{\r\n\t\t\t// Arrange\r\n\t\t\tLoginAsEditor();\r\n\t\t\tCreatePageWithTags(\"Homepage\");\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#pageedit-button\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"input[value=Save]\")).Click();\r\n\t\t\tLogout();\r\n\r\n\t\t\t// Act\r\n\t\t\tDriver.FindElement(By.CssSelector(\"a[href='/pages/allpages']\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\".table td a\")).Click();\r\n\t\t\tDriver.FindElement(By.CssSelector(\"#viewhistory a\")).Click();\r\n\r\n\t\t\t// Assert\r\n\t\t\tAssert.That(Driver.FindElements(By.CssSelector(\".table .revert a\")).Count, Is.EqualTo(0));\r\n\t\t}\r\n\t}\r\n}\r\n"]],"start1":0,"start2":0,"length1":0,"length2":12861}]],"length":12861}
{"contributors":[],"silentsave":false,"ts":1354887770858,"patch":[[{"diffs":[[-1,"﻿"],[0,"usin"]],"start1":0,"start2":0,"length1":5,"length2":4},{"diffs":[[0,")]\r\n"],[-1,"\t[Explicit]\r\n"],[0,"\tpub"]],"start1":617,"start2":617,"length1":21,"length2":8}]],"length":12847,"saved":false}
